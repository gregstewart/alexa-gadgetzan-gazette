import nock from 'nock';
import fs from 'fs';

import {fetchNewsToSpeak} from '../fetch-news-to-speak';

describe('test integration', () => {
  let html;
  beforeEach(() => {
    html = fs.readFileSync('./test/fixtures/icy-veins.html', 'utf8');
    nock('http://www.icy-veins.com')
      .get('/')
      .reply(200, html);
  });

  it('returns the expected response', (done) => {
    const expected = `<speak><p>Welcome to the Gadgetzan Gazette!</p><p>Here is the news from Icy Veins</p><p>Patch 7.1.5 Build 23244: Class Changes</p><p>Class changes related to the latest build of Patch 7.1.5.</p><p>Facebook Live Q/A: Dec 15</p><p>Diablo\'s getting a Q/A on Facebook Live today. Joe Senior Game Designer Joe Shely will be answering your questions.</p><p>Patch 7.1.5 Build 23244: Legendary Item Changes</p><p>Following the announcement of future changes to legendaries on PTR, Build 23244 has arrived and many legendary items have been nerfed.</p><p>Ragnaros Build Guide</p><p>Our guide section has been updated to include Ragnaros, the Firelord!</p><p>Gold Making: Daily Obliterum Routine</p><p>A quick gold making method that requires very little work. You only need to have the Obliterum Forge unlocked. It has no reputation requirements.</p><p>Mists of Pandaria Timewalking Preview [Official]</p><p>Timewalking is one of those great ideas that was implemented and is just begging to be expanded to raids as well as dungeons, but until that happens at least we\'re getting some more old 5 mans to enjoy with the addition of MoP to the Timewalking roster!\tYou can also check out our own preview of the new additions here.</p><p>Tavern Brawl: The Battle for Gadgetzan</p><p>This week\'s Tavern Brawl is called The Battle for Gadgetzan. It is the seventy ninth Tavern Brawl.</p><p>Ragnaros Patch Now Live</p><p>A new patch was just released in Americas. It brings the Winter Veil, a new Hero, ranked play changes and balance updates.</p><p>Un\'Goro Madness Micro-Holiday</p><p>Our micro-holiday preview continues with Un\'Goro Madness that\'s scheduled for August 10.</p><p>Illidan\'s Story Update and UH Death Knight Changes</p><p>New quests related to Illidan\'s fate have been added and Unholy Death Knights are getting a small buff in the next PTR Build.</p><p>7.1 Hotfixes: December 13th</p><p>As Season 2 was opened today some minor hotfixes have just appeared with Prestige level 8 becoming available and some additional tweaks to PvP stats.</p><p>Substantial Legendary Changes Coming to PTR</p><p>It seems there will be some major changes coming to legendaries in the next PTR build, including nerfs to the more powerful and "always useful ones" as well as buffs to situational ones:</p><p>WTF Moments Episode 71</p><p>The 71th episode of WTF Moments doesn\'t cease to amaze, especially if you\'re a fan of Slug Life!</p><p>The Winter Wonderland Event Is Here!</p><p>As previously teased the latest thematic event has arrived and is one of the classics! 100 new cosmetic items will be popping out of the present-wrapped loot boxes, including profile icons, sprays, victory poses, emotes, highlight intros, skins, and more.</p><p>New Hearthstone Commerical Revealed</p><p>Blizzard have revealed their latest Hearthstone advertising campaign that will air over the Christmas period.</p><p>This Week in WoW: Dec 13</p><p>Withered J\'m is this week\'s World Boss, Legion PvP Season 2 launches today, 8th week of Insurrection is here and final dungeon bosses will grant an additional piece of loot.</p><p>Glowcap Festival Micro-Holiday</p><p>The Glowcap festival takes place in Zangarmarsh on May 25. You may remember Sporeggar reputation from the Burning Crusade.</p><p>Blue Posts Round-up: Dec 12</p><p>Topics discussed today are reputation improvements for alts, fixes to tab targeting and communication standards.</p><p>Blizzard Launches Own Book-Publishing Label</p><p>Blizzard has established an own book-publishing label according to the latest press release.</p><p>Method Post-Trial of Valor WF Interview</p><p>World First Helya killers Method talk bans, bosses, Nighthold preparations and more.</p><p>Patch 7.1.5: Spring Balloon Festival Micro-Holiday</p><p>Spring Balloon Festival is the next micro-holiday that\'s currently tested on PTR. It will be available on May 8.</p><p>Free-to-Play Hero Rotation: Dec 13</p><p>The Free Hero Rotation was updated prior to the release of Ragnaros!</p><p>Serenity Mythic+ 20 DHT Clear</p><p>Serenity managed to do a Mythic+ 20 Darkheart Thicket Keystone clear within the time limit and their key got upgraded to M+ 21 Eye of Azshara. The run was done using a depleted key.</p><p>PTR Patch 2.4.3 Hotfixes</p><p>A new round of hotfixes was applied to test realms where Patch 2.4.3 is currently playtested.</p><p>Gold Making: Winter Veil Eggs</p><p>Winter Veil is coming to Azeroth on December 16 and it\'s an opportunity to make some extra gold.</p><p>Patch 7.1.5: Volunteer Guard Day Micro-Holiday</p><p>The Volunteer Guard Day lets you take on the role of a guard by performing the /salute emote on them. The micro-holiday will be live on April 23.</p><p>Heroes Balance Q/A Summary</p><p>The recap features highlights of the latest Balance Q/A from reddit. Balance Designers have been answering your questions.</p><p>2016 Fall Champion\'s Mount</p><p>Ballistix claimed the title of Fall Champions and the $300,000 grand prize at BlizzCon. Blizzard is adding their mount to the game with the next patch.</p><p>Gul\'dan Testing and Blue Posts (Class Feedback)</p><p>Elisande and Gul\'dan are available for testing on December 13. Another set of blues is up dealing with MM Hunters, Rogues and Destruction Warlocks.</p><p>Brawl with the Blues: Ragnaros (Special Edition)</p><p>Brawl with the Blues returns with a special edition on Thursday, December 15. Join Trisklyr and some prominent community members to explore some of the upcoming changes.</p></speak>`
    fetchNewsToSpeak().then((response) => {
      expect(response).to.equal(expected);
      done()
    }).catch((error) => {
      console.log(error);
      expect(error).to.be.undefined;
    });
  });
});
